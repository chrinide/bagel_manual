.. _zfci:

****************************************************
Relativistic full configuration interaction (RelFCI)
****************************************************

Description
===========

Relativistic CI differs from non-relativistic CI primarily in the Hamiltonian which is used in the diagonalization. Use of a relativistic Hamiltonian includes spin-orbit coupling and the associated mixing of different spin-multiplets. While particular relativistic Hamiltonian employed can have a significant impact on the computational cost, there are three possible options for increasing accuracy. It is worth noting that all of the states within a given spin multiplet are treated individually; therefore, there may be many degenerate solutions. To avoid artificially breaking this degeneracy, it is preferable to avoid requesting the calculation of only some of the states in a multiplet.


Prerequisites
==============
A reference wavefunction generated by a :ref:`HF <hf>`, :ref:`CASSCF <casscf>`, :ref:`FCI <fci>`, :ref:`DHF <dhf>` or :ref:`RASCI <rasci>` calculation. However, it should be noted that if the reference wavefunction is not from a previous :ref:`dhf` calculation, the calculation will automatically run a :ref:`DHF <dhf>` calculation to generate a relativistic reference. 

Keywords
========


.. topic:: ``maxiter (or maxiter_fci)``

   | **Description**: Maximum number of iterations in the FCI algorithm.
   | **Datatype**: int
   | **Default**: 100
   | **Recommendation**: Use default value. 

.. topic:: ``davidson_subspace``

   | **Description**:  Number of vectors retained in the limited-memory Davidson algorithm.
   | **Datatype**: int
   | **Default**: 20
   | **Recommendation**: Any number above 3 is reasonable.  

.. topic:: ``thresh (or thresh_fci)``

   | **Description**: Threshold for the convergence of the selected CI algorithm.
   | **Datatype**: double
   | **Default**: 1.0e-10 
   | **Recommendation**: Use default value.

.. topic:: ``print_thresh``

   | **Description**: Threshold below which CI coefficients are not printed.  
   | **Datatype**: double
   | **Default**: 0.05

.. topic:: ``state``

   | **Description**: Number of states computed for each spin value.
   | **Datatype**: vector<int>
   | **Default**: There is no default; this parameter must be supplied in the input.  
   | **Note**: An array of integers is supplied, where each one indicates the number of states for a given spin value.  For example, the input [ 1 ] gives a singlet ground state, while [ 3, 0, 1 ] gives three singlets and one triplet (6 states total).  Be careful!  While the spin values you specified are used in generating the guess CI coefficients, the spin vectors will mix, and the algorithm returns the *n* lowest eigenstates regardless of their spin expectation values.  

.. topic:: ``gaunt``

   | **Description**: Used to specify the form of the 2-electron Hamiltonian.  The default is the Dirac--Coulomb Hamiltonian. If ``gaunt`` is set to true, the Gaunt interaction will be added, which accounts for direct spin--spin and spin-other-orbit coupling between electrons.  
   | **Datatype**: bool
   | **Default**: Value obtained from reference wavefunction.  
   | **Recommendation**: Choose based on the importance of the relativistic effects in your problem.  

.. topic:: ``breit``

   | **Description**: Used to determine whether the full Breit interaction (including the gauge term) is included in the two-electron Hamiltonian.  
   | **Datatype**: bool
   | **Default**: Value obtained from reference wavefunction.  
   | **Recommendation**: Choose based on the importance of relativistic effects in your problem.  

.. topic:: ``frozen``

   | **Description**: If this is set to true, and ``ncore`` is not specified, then core molecular orbitals are frozen in all Slater determinants.  
   | **Datatype**: bool
   | **Default**: false
   | **Recommendation**: Frozen orbitals reduce the computational cost with some tradeoff in accuracy.  Freezing the core is often a good compromise, but this will depend on your particular problem. 

.. topic:: ``ncore``

   | **Description**: Number of core molecular orbitals to be frozen as doubly occupied in all determinants.  This parameter overrides the default determined by ``frozen``.
   | **Default**: Either zero or all core orbitals, depending on the ``frozen`` parameter.  

.. topic:: ``norb``

   | Description: Number of correlated orbitals. Any high-energy orbitals in excess of this number will be unoccupied.
   | Datatype: int
   | Default: All molecular orbitals except those excluded using ncore.
   | Recommendation: Include all virtual orbitals, if you can afford it.

.. topic:: ``only_ints``

   | **Description**: Used to compute integrals, print to a file, and terminate the program. This can be used to interface BAGEL to an external CASSCF solver.  
   | **Default**: false
   | **Datatype**: bool
   | **Recommendation**: Use the default value.  

.. topic:: ``spin_adapt``

   | **Description**: This parameter allows us to deactivate the generation of spin-adapted configuration state functions in the starting guess of the CAS-CI part.  
   | **Default**: true
   | **Datatype**: bool
   | **Recommendation**: Normally use the default setting. If you are computing all or nearly all the states that can be formed with a given active space, you will encounter an error stating that "generate_guess produced an invalid determinant."  Deactivating this feature leads to a poorer guess but eliminates this problem.  

.. topic:: ``charge``

   | **Description**: The total charge of the system.
   | **Default**:  0
   | **Datatype**: int

.. topic:: ``active``

   | **Description**: Orbital indices for the orbitals to be included in the active space.  
   | **Default**: Frontier orbitals are used. If a DHF reference waveunction (or Hcore guess) is used, the canonical orbitals are ordered by orbital energy, the ``nclosed`` lowest-energy orbitals are set to closed, and the next ``nact`` are set to active. If the reference wavefunction was generated by CASSCF, the order of orbitals is maintained.  
   | **Datatype**: vector<int>
   | **Recommendation**:  The convergence behavior is often improved by choosing guess orbitals similar in character to your target active orbitals. For both relativistic Hartree--Fock and CASSCF, useful tools to identify good starting orbitals include using the ``pop`` keyword to print orbital population analysis and using the ``moprint`` module to visualize orbital densities using the Gaussian cube format.  

.. topic:: ``aniso``

   | **Description**: This is the key for a block in the input file which provides parameters for magnetic anisotropy analysis (the determination of g-factors and zero-field splitting parameters). See below for details.  
   | **Values**: `any int`
   | **Recommendation**: The electronic charge of the system.

.. topic:: ``active``

   | **Description**:  Orbital indices for the spatial MOs that should be included in the active space.
   | **Default**:  Frontier orbitals are used.  If a DHF reference waveunction (or Hcore guess) is used, the canonical orbitals are ordered by orbital energy,
   |     the "nclosed" lowest-energy orbitals are set to closed, and the next "nact" are set to active.  If the reference wavefunction was
   |     generated by CASSCF, the order of orbitals is maintained.
   | **Datatype**: vector<int>
   | **Recommendation**:  The convergence behavior is often improved by choosing guess orbitals similar in character to your target active
   |     orbitals. For both relativistic Hartree--Fock and CASSCF, useful tools to identify good starting orbitals include using the "pop" keyword to
   |     print orbital population analysis and using the "moprint" module to visualize orbital densities using Gaussian cube format.

.. topic:: ``aniso``

   | **Description**:  This is the key for a block in the input file which provides parameters for magnetic anisotropy analysis, in determination of g-factors and zero-field splitting parameters.  See below for details.

.. topic:: ``restart``

   | **Description**: Generate binary archive files that can be used to restart an incomplete calculation.
   | **Default**: false
   | **Datatype**: bool

Example
=======
A RelFCI calculation on selenium dioxide.

Sample input
------------

.. code-block:: javascript

 { "bagel" : [

 {
  "title" : "molecule",
  "angstrom" : true,
  "basis" : "tzvpp",
  "df_basis" : "tzvpp-jkfit",
  "geometry" : [
    { "atom" : "Se",  "xyz" : [  0.000,  0.0000,  0.2807  ] },
    { "atom" : "O",  "xyz" :  [  0.000,  1.3464, -0.5965  ] },
    { "atom" : "O",  "xyz" :  [  0.000, -1.3464, -0.5965  ] }
  ]
 },


 {
  "title" : "dhf",
  "gaunt" : true,
  "breit" : false,
 },

 {
  "title" : "zfci",
  "spin" : 1 ,
  "state" : [1],
  "ncore" : 20,
  "norb" :  9,
  "davidson_subspace" : "10",
  "thresh" : 5.0e-10
 }

 ]}


Sample output
-------------

.. code-block:: javascript

  ----------------------------
  Relativistic FCI calculation
  ----------------------------

    * Correlation of 10 active electrons in 9 orbitals.
    * Time-reversal symmetry will be assumed.
    * gaunt    : true
    * breit    : false
    * nstate   :      1
    * nclosed  :     20
    * nact     :      9
    * nvirt    :    191
  *** Geometry (Relativistic) ***
       - 3-index ints post                         0.00
       - 3-index ints prep                         0.00
       - 3-index ints                              0.49
       - 3-index ints post                         0.00
       - 3-index ints prep                         0.00
       - 3-index ints                              0.10
       - 3-index ints post                         0.00

       - Geometry relativistic (total)             0.59

       - Coulomb: half trans                       0.59
       - Coulomb: metric multiply                  2.34
       - Coulomb: J operator                       0.06
       - Coulomb: K operator                       0.60
       - Gaunt: half trans                         0.35
       - Gaunt: metric multiply                    1.31
       - Gaunt: J operator                         0.13
       - Gaunt: K operator                         1.73
       - Coulomb: half trans                       0.56
       - Coulomb: metric multiply                  1.50
       - Coulomb: J operator                       0.05
       - Coulomb: K operator                       0.47
       - Gaunt: half trans                         0.27
       - Gaunt: metric multiply                    0.91
       - Gaunt: J operator                         0.09
       - Gaunt: K operator                         1.40
    * Integral transformation done. Elapsed time: 7.49

       - jop, kop                                  0.00
       - denom                                     0.00
     guess   0:   closed 11111....            open .........

                 * guess generation                            0.00
  === Relativistic FCI iteration ===

                 * sigma vector                                0.91
                 * davidson                                    0.00
                 * error                                       0.00
                 * denominator                                 0.00
      0   0      -2575.49908253     9.48e-04      0.91
                 * sigma vector                                0.89
                 * davidson                                    0.00
                 * error                                       0.00
                 * denominator                                 0.00

                 ..............................

                 ... A few iterations later ...

                 ..............................

    ** throwing out 1 trial vectors **
                 * davidson                                    0.01
                 * error                                       0.00
                 * denominator                                 0.00
     26   0  *   -2575.54892391     3.55e-10      0.90

     * ci vector, state   0

     * ci vector, state   0

     * ci vector, state   0
       222bbbb..  (-0.0500743568,0.0000000007)

     * ci vector, state   0

     * ci vector, state   0
       22222....  (0.9593555207,0.0000000000)
       2222.2...  (-0.1404147020,-0.0000000000)
       2.2222...  (-0.0847212161,-0.0000000000)
       2b222a...  (-0.0715085374,0.0000000000)
       2a222b...  (-0.0715085374,-0.0000000000)
       222.22...  (-0.0541706237,-0.0000000000)

     * ci vector, state   0

     * ci vector, state   0
       222aaaa..  (-0.0500743568,-0.0000000007)

     * ci vector, state   0

     * ci vector, state   0


References
==========

+----------------------------------------------------+--------------------------------------------------------------------+
|          Description of Reference                  |                          Reference                                 |
+====================================================+====================================================================+
| Efficient calculation of sigma vector              | P\. J. Knowles and N. C. Handy, Chem. Phys. Lett. **111**, 315     |
|                                                    | (1984).                                                            |
+----------------------------------------------------+--------------------------------------------------------------------+
| General text on relativistic quantum chemistry     | K\. G. Dyall and K. Faegri Jr.,                                    |
|                                                    | *Introduction to Relativistic Quantum Chemistry*                   |
|                                                    | (Oxford University Press, Oxford, 2007).                           |
+----------------------------------------------------+--------------------------------------------------------------------+
| Restricted kinetic balance basis                   | W\. Kutzelnigg, Int. J. Quantum Chem. **25**, 107 (1984).          |
+----------------------------------------------------+--------------------------------------------------------------------+

