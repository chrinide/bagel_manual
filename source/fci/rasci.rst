.. index:: rasci

.. _rasci:

*********************************************************
Restricted active space configuration interaction (RASCI)
*********************************************************

===========
Description 
===========

The basis into which the wavefunction is expanded is typically constructed by
applying excitation operators to the determinant(s) included in the ground
state wavefunction. The Restricted Active Space (RAS) method constrainst the
types of excitations which can occur resulting in a smaller basis, and ideally
a lower computational cost than that of full CI.  In RASCI as implemented in
Bagel, the user constrains the excitations by specifying three "active" spaces,
R1, R2 and R3, which are three sets of orbitals.  The determinants in the CI
expansion are obtained by exciting from R1 into R2, from R2 to R3, or between
occupied and unoccupied orbitals in R2.  The number of excitations between R1
and R2 is constrained by specifying the maximium number of holes which can
occur in R1, whilst the number of excitations between R2 and R3 is constrained
by specifying the maximium number of electrons which can occur in R2. 


This is useful close analysis of the impact of specific
excitations on dynamic correlation effects, and also for investigating
properties which depend on only a few specific excitations (e.g., x-ray
adsorption spectra). The disadvantage is that the RASCI basis smaller than CI,
and that the active spaces must be selected with caution.

The RASCI method is closely related to the :ref:`rasci` method.


==================
Prerequisites
==================
A reference wavefunction generated by some kind of :ref:`hf`, :ref:`casscf`, or :ref:`fci`-type calculation.

============
Keywords
============


.. topic:: ``active``

   | **Description**: Specifies the three active spaces used to generate the funcitons in the CI expansion.
   | **Default**: Must be specified by user.
   | **Datatype**: Three arrays of integers (see example).
   | **Values** : Three arrays with the containing indexes which specficy the orbitals between which excitations are permitted to occur.
   | **Recommendation** : This is highly system dependent, and dependent on the system under investigation. It is often good to run an initial Hartree Fock calculation, visualize the resulting orbitals in Molden (see section PRINT SECTION), and pick the spaces on the basis of chemical intuition. 

.. topic:: ``max_holes``

   | **Description**: Maximum number of particles in R1.
   | **Default**: 0 
   | **Datatype** : integer
   | **Values**: Any integer which is possible given the initial occupation of R1 and R2..  
   | **Recommendation** : System dependent, note that larger values increase the number of possible configurations, and hence the cost of the calculation.


.. topic:: ``max_particles``

   | **Description**: Maximum number of particles in R3.
   | **Default**: 0 
   | **Datatype** : integer
   | **Values**: Any integer which is possible given the initial occupation of R2 and R3..  
   | **Recommendation** : System dependent, note that alrger values increase the number of possible configurations, and hence the cost of the calculation.

.. topic:: ``nspin``

   | **Description**: Specifies the number of unpaired electrons, e.g., a triplet has an nspin of 2.
   | **Default**: 0 
   | **Datatype** : integer
   | **Values**: Any integer.  
   | **Recommendation** : The spin of the states or interest. 

.. topic:: ``algorithm``
   
   | **Description**: Algorithm to be used in the determinantion of the CI coeffcients.
   | **Default**: KH.
   | **Datatype**: string
   | **Values**: 
   |    ``KH, Knowles, Handy``: use Knowles-Handy.
   |    ``HZ, Harrison, Zarrabian``: use Harrison-Zarrabian.
   |    ``Dist, parallel``: use Parallel algorithm.
   | **Recommendation**: If the active space is large and you have multiple processors, use Dist. Otherwise, use default.

.. topic:: ``charge``

   | **Description**: The electronic charge of the system.
   | **Default**:  0
   | **Datatype**: integer
   | **Values**: `any int`
   | **Recommendation**: The electronic charge of the system. 

.. topic:: ``maxiter``

   | **Description**: Maximum number of iterations in RASCI algorithm 
   | **Default**: 100 
   | **Datatype**: integer
   | **Values**: ``Any positive integer``
   | **Recommendation**: Keep as default. Whilst higher values can be experimented with, failure too converge could also indicate an issue with the reference function, active spaces, or requested states.

.. topic:: ``davidson_subspace``

   | **Description**: Maximum dimension of subspace used for Davidson diagonalization
   | **Default**: 20 
   | **Datatype**: integer
   | **Values**: ``Any positive integer``
   | **Recommendation**: In most cases  it is best to use the default. If a large number of states are being requested if may be worth increasing it.

.. topic:: ``nstate``

   | **Description**: Number of states to calculate. If set to one, it calculates the ground state.
   | **Default**:1
   | **Datatype**: integer
   | **Values**: ``any positive double``
   | **Recommendation**: User dependent, calculation of multiple states are slower.

.. topic:: ``thresh```

   | **Description**: Threshold for convergence of selected RASCI algorithm 
   | **Default**: 1.0e-10 
   | **Datatype**: double
   | **Values**: ``any positive double``
   | **Recommendation**: Default, reduce for greater accuracy.

.. topic:: ``batchsize```

   | **Description** : Number of terms from RASCI interaction to be evaluated at simulataneously.
   | **Default**: 512 
   | **Datatype**: integer
   | **Values**: ``any positive integer``
   | **Recommendation**: Default, the optimimum value willbe system dependent.

=======
Example
=======

A water molecule. The first active space, R1, contains the oxygen 1s orbital, the second active space, 
R2 contains the 1a1, 1b1, 2a1 and 2b1, orbitals. The third active space, R3, contains the 
3a1 and 2b2 antibonding orbitals. One excitation is allowed from R1 to R2, and two excitations are allowed from
R2 to R3.

Sample input
------------

.. code-block:: javascript 

 { "bagel" : [
 { "title" : "molecule", 
   "basis" : "tzvpp",
   "df_basis" : "tzvpp-jkfit",
   "angstrom" : true,
   "geometry" : [
    { "atom" : "H", "xyz" : [ -0.22767998367, -0.82511994081,  -2.66609980874] },
    { "atom" : "O", "xyz" : [  0.18572998668, -0.14718998944,  -3.25788976629] },
    { "atom" : "H", "xyz" : [  0.03000999785,  0.71438994875,  -2.79590979943] }
  ]
 },

 {
  "title" : "hf",
  "thresh" : 1.0e-12
 },

 { "title" : "ras",
  "nstate" : 2,
  "active" : [ [1],
             [2, 3, 4, 5],
             [6, 7] ],
  "max_holes" : 1,
  "max_particles" : 2,
  "maxiter" : 10,
  "thresh" : 1.0e-7
 }
 ]}


Sample output
-------------

.. code-block:: javascript 

     * ci vector   0, <S^2> = 0.0000, E =      -76.06133473
       2-2222-..     0.9989778414

     * ci vector   1, <S^2> = 0.0000, E =      -75.73609103
       2-222a-b.    -0.6985148618
       2-222b-a.    -0.6985148618
       2-2a2b-ab    -0.0695352914
       2-2b2a-ba    -0.0695352914
       2-2b2b-aa    -0.0513545763
       2-2a2a-bb    -0.0513545763
       2-22ab-2.    -0.0510585950
       2-22ba-2.    -0.0510585950

References
===========

+-----------------------------------------------+---------------------------------------------------------------------+
|          Description of Reference             |                           Reference                                 | 
+===============================================+=====================================================================+
| Efficient calculation of sigma vector         | P.\ J. Knowles and N. C. Handy, Chem. Phys. Lett.                   |
|                                               | **111**, 315-321 (1984).                                            |
+-----------------------------------------------+---------------------------------------------------------------------+
| RASCI algorithm                               | J\. Olsen, B. O. Roos, P. Jorgensen, and H. J. A.-Jensen, J. Chem.  |
|                                               | Phys. **89**, 2185-2192 (1988).                                     |
+-----------------------------------------------+---------------------------------------------------------------------+


